# セーリング戦略分析システム - デプロイメント手順

このドキュメントでは、セーリング戦略分析システムをStreamlit Cloudにデプロイする手順を説明します。

## 前提条件

- GitHubアカウント
- Streamlit Cloudアカウント (https://streamlit.io/cloud)
- Pythonの基本的な知識

## デプロイ準備

### 1. リポジトリの準備

1. GitHubリポジトリが以下のファイル構造になっていることを確認します：
   ```
   sailing-strategy-analyzer/
   ├── .streamlit/
   │   └── config.toml         # Streamlit設定ファイル
   ├── ui/
   │   ├── app_v5.py           # メインアプリケーションファイル
   │   └── ...                 # その他UIコンポーネント
   ├── sailing_data_processor/ # コアロジックのパッケージ
   ├── requirements.txt        # 依存パッケージリスト
   ├── README.md               # リポジトリの説明
   └── ...
   ```

2. `requirements.txt` が最新であることを確認します：
   - すべての必要な依存パッケージが含まれていること
   - バージョン指定が明確であること
   - 不要な開発用パッケージは除外されていること

3. `.streamlit/config.toml` ファイルがStreamlit Cloudでの実行に適した設定になっていることを確認します。

### 2. メインアプリケーションファイルの確認

1. Streamlit Cloudは、リポジトリのルートにある `app.py` または `streamlit_app.py` を自動的に検出します。
   
2. 現在のアプリケーションファイル `ui/app_v5.py` をリポジトリのルートに移動するか、リンクを作成します：
   ```bash
   # オプション1: ファイルをコピー
   cp ui/app_v5.py streamlit_app.py
   
   # オプション2: シンボリックリンクを作成（Linux/Mac）
   ln -s ui/app_v5.py streamlit_app.py
   ```

3. **重要**: アプリケーションがローカルファイルシステムに依存している場合、Streamlit Cloudでの実行に問題が生じる可能性があります。ファイル保存について以下の対応を検討してください：
   - ブラウザのローカルストレージを使用
   - 一時ファイルを使用
   - クラウドストレージサービスとの連携

## Streamlit Cloudへのデプロイ

### 1. Streamlit Cloudにサインアップ/ログイン

1. https://streamlit.io/cloud にアクセス
2. GitHubアカウントでサインアップまたはログイン

### 2. アプリケーションのデプロイ

1. Streamlit Cloudダッシュボードで「New app」ボタンをクリック
2. リポジトリURL（例: `https://github.com/username/sailing-strategy-analyzer`）を入力
3. ブランチを選択（通常は `main` または `master`）
4. メインファイルのパスを指定：`streamlit_app.py`
5. 必要に応じて以下の設定を行います：
   - アプリ名
   - Python版数（3.9以上推奨）
   - 高度な設定（メモリ、タイムアウトなど）
6. 「Deploy」ボタンをクリック

### 3. デプロイのモニタリング

1. デプロイプロセスはStreamlit Cloudダッシュボードで監視できます
2. ログを確認し、エラーがあれば対処します
3. デプロイが完了すると、アプリケーションのURLが表示されます（例: `https://username-sailing-strategy-analyzer.streamlit.app`）

## デプロイ後の注意点

### 1. リソース制限

Streamlit Cloudの無料プランには以下の制限があります：
- メモリ: 1GB
- ファイルストレージ: 一時的なもののみ（永続化なし）
- 同時接続数: 制限あり
- スリープモード: 一定時間使用されないとアプリがスリープします

これらの制限が問題になる場合は、有料プランへのアップグレードを検討してください。

### 2. セキュリティ考慮事項

- シークレットやAPIキーは環境変数として設定し、コードに直接記述しないでください
- 一般公開される情報に個人情報や機密情報が含まれていないことを確認してください
- 必要に応じて、アクセス制限を設定してください

### 3. 更新とメンテナンス

アプリケーションの更新方法：
1. GitHubリポジトリに変更をコミット＆プッシュ
2. Streamlit Cloudの自動デプロイ機能により、変更が自動的に反映されます（設定されている場合）
3. 手動で再デプロイする場合は、Streamlit Cloudダッシュボードから「Reboot app」を選択

## トラブルシューティング

1. **デプロイエラー**:
   - ログを確認してエラーメッセージを特定
   - 不足している依存パッケージがないか確認
   - `requirements.txt` の問題を解決
   - ファイルパスが適切か確認（特にWindows開発環境からの場合）

2. **実行時エラー**:
   - ローカルファイルシステムへの依存がないか確認
   - 環境変数が正しく設定されているか確認
   - メモリ使用量を監視（制限を超えていないか）

3. **パフォーマンスの問題**:
   - データの事前処理を最適化
   - キャッシュ機能を活用（`@st.cache` デコレータ）
   - 必要に応じてデータサイズを削減

## ヘルプとサポート

技術的な問題やデプロイに関する質問がある場合は、以下の方法でサポートを求めることができます：

1. GitHubリポジトリのIssueを開く
2. Streamlit Cloudのサポートページ (https://docs.streamlit.io/knowledge-base) を参照
3. Streamlitコミュニティフォーラム (https://discuss.streamlit.io/) で質問
